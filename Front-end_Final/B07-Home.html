<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bienvenido a Malasa - Cocina India</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- Estilos Generales y Tema "Malasa" --- */
      :root {
        --color-primario: #ff9933;
        --color-secundario: #8b4513;
        --color-fondo-pagina: #fdfaf5;
        --color-surface: #ffffff;
        --color-texto: #4a2e2a;
        --color-texto-secundario: #6c757d;
        --color-fondo-modal: #fff8e1;
        --color-accion-modal: #007bff;
        --fuente-titulos: "Lora", serif;
        --fuente-cuerpo: "Open Sans", sans-serif;
      }

      body {
        font-family: var(--fuente-cuerpo);
        background-color: var(--color-fondo-pagina);
        color: var(--color-texto);
        margin: 0;
        line-height: 1.6;
      }

      /* Navbar Styles */
      .navbar {
        background-color: var(--color-surface);
        padding: 0.5rem 1rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .navbar-container {
        width: 100%;
        max-width: 1140px;
        margin: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .navbar-brand {
        font-family: var(--fuente-titulos);
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--color-texto);
        text-decoration: none;
        display: flex;
        align-items: center;
      }
      .navbar-brand img {
        width: 40px;
        height: 40px;
        object-fit: cover;
        border-radius: 50%;
        margin-right: 0.5rem;
      }
      .navbar-nav {
        list-style: none;
        display: flex;
        gap: 1.5rem;
        margin: 0;
      }
      .nav-link {
        color: var(--color-texto);
        text-decoration: none;
        font-weight: 600;
        cursor: pointer;
      }
      .nav-link.active,
      .nav-link:hover {
        color: var(--color-primario);
      }

      /* Estilos específicos para botones de estado (ocultos por defecto) */
      #nav-btn-admin,
      #nav-btn-logout,
      #nav-btn-profile {
        display: none; /* Se activan vía JS */
      }
      #nav-btn-admin {
        color: #d32f2f;
      }

      /* Hero & Sections */
      .hero {
        background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
          url("images/Home/bienvenida.webp") no-repeat center center;
        background-size: cover;
        color: white;
        padding: 6rem 1rem;
        text-align: center;
      }
      .hero h1 {
        font-family: var(--fuente-titulos);
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
      }
      .hero p {
        font-size: 1.25rem;
        max-width: 600px;
        margin: 0 auto 2rem auto;
      }
      .cta-button {
        background-color: var(--color-primario);
        color: var(--color-secundario);
        padding: 0.8em 2em;
        text-decoration: none;
        font-weight: 700;
        border-radius: 25px;
        transition: transform 0.2s;
        display: inline-block;
      }
      .cta-button:hover {
        transform: scale(1.05);
      }

      .section {
        padding: 4rem 1rem;
        max-width: 960px;
        margin: auto;
        text-align: center;
      }
      .section-title {
        font-family: var(--fuente-titulos);
        font-size: 2.5rem;
        color: var(--color-secundario);
        margin-bottom: 0.5rem;
      }
      .section-subtitle {
        font-size: 1.1rem;
        color: var(--color-texto-secundario);
        max-width: 600px;
        margin: 0 auto 2rem auto;
      }

      #menu {
        background: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)),
          url("images/Cordero/1.png") no-repeat center center;
        background-size: cover;
        color: white;
        border-radius: 15px;
        max-width: 960px;
        margin: 4rem auto;
      }
      #menu .section-subtitle {
        color: #f0f0f0;
      }

      #about .about-content {
        display: flex;
        align-items: center;
        gap: 2rem;
        text-align: left;
      }
      #about img {
        width: 40%;
        border-radius: 8px;
      }
      #location .location-content {
        display: flex;
        align-items: center;
        gap: 2rem;
        text-align: left;
      }
      #location .google-map {
        width: 50%;
        height: 250px;
        border: 0;
        border-radius: 8px;
      }
      #contact {
        background-color: #fff;
      }

      .footer {
        background-color: var(--color-secundario);
        color: var(--color-fondo-pagina);
        text-align: center;
        padding: 2rem 1rem;
      }

      /* Estilos del Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .modal-overlay:not(.hidden) {
        opacity: 1;
        visibility: visible;
      }
      .hidden {
        display: none !important;
      }

      .modal-card {
        background-color: var(--color-fondo-modal);
        border-radius: 10px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        padding: 2.5em;
        text-align: center;
      }
      .close-modal-btn {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 2rem;
        color: var(--color-texto-secundario);
        background: none;
        border: none;
        cursor: pointer;
        line-height: 1;
      }

      .modal-card .card-title {
        font-family: var(--fuente-titulos);
        color: var(--color-secundario);
        font-weight: 600;
        font-size: 2em;
        margin-bottom: 1em;
      }
      .modal-card .form-floating {
        position: relative;
        margin-bottom: 1.5rem;
        text-align: left;
      }
      .modal-card .form-control {
        width: 100%;
        padding: 1rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #fff;
        box-sizing: border-box;
      }
      .modal-card .btn-primary {
        background-color: var(--color-secundario);
        border: none;
        border-radius: 25px;
        padding: 0.8em;
        font-size: 1.1em;
        font-weight: 600;
        color: white;
        width: 100%;
        cursor: pointer;
        margin-bottom: 1em;
        transition: background-color 0.3s;
      }
      .modal-card .btn-primary:hover {
        background-color: #6a350f;
      }
      .modal-card .register-link a {
        color: var(--color-secundario);
        font-weight: 600;
        text-decoration: none;
      }

      /* Estilos específicos para Recuperación */
      .alert-simulation {
        background-color: #e3f2fd;
        border: 1px solid #2196f3;
        color: #0d47a1;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 15px;
        font-size: 0.9em;
        text-align: left;
      }
      .fade-in {
        animation: fadeIn 0.4s forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <!-- BARRA DE NAVEGACIÓN -->
    <nav class="navbar">
      <div class="navbar-container">
        <a class="navbar-brand" href="#">
          <img src="images/Logo/flor.jpg" alt="Logo Masala" />
          Malasa
        </a>
        <ul class="navbar-nav">
          <li><a class="nav-link active" href="B07-Home.html">Home</a></li>
          <li><a class="nav-link" href="B04_B05-Catalogo.html">Catálogo</a></li>
          <li>
            <a class="nav-link" href="B06-Formulario_de_Contacto.html"
              >Contacto</a
            >
          </li>

          <!-- Botones Controlados por menu_logic.js -->
          <li>
            <a class="nav-link" id="nav-btn-login" href="#">Iniciar Sesión</a>
          </li>
          <li>
            <a
              class="nav-link"
              id="nav-btn-profile"
              href="B08_B09-Perfil_de_usuario.html"
              >Mi Perfil</a
            >
          </li>
          <li>
            <a
              class="nav-link"
              id="nav-btn-admin"
              href="B17-Gestion_de_Productos.html"
              >Panel Admin</a
            >
          </li>
          <li><a class="nav-link" id="nav-btn-logout" href="#">Salir</a></li>
        </ul>
      </div>
    </nav>

    <header class="hero">
      <h1>El Sabor Auténtico de la India</h1>
      <p>
        Un viaje culinario a través de especias, aromas y tradiciones que
        deleitarán tus sentidos.
      </p>
      <a href="#menu" class="cta-button">Ver La Carta</a>
    </header>

    <main>
      <!-- ========================================= -->
      <!-- MODAL DE LOGIN -->
      <!-- ========================================= -->
      <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-card">
          <button class="close-modal-btn" data-target="login-modal">
            &times;
          </button>
          <h3 class="card-title">Iniciar Sesión</h3>
          <form id="login-form">
            <div class="form-floating">
              <input
                type="email"
                class="form-control"
                id="emailLogin"
                required
                placeholder="name@example.com"
              />
            </div>
            <div class="form-floating">
              <input
                type="password"
                class="form-control"
                id="passLogin"
                required
                placeholder="Contraseña"
              />
            </div>

            <a
              href="#"
              id="link-forgot-password"
              style="
                display: block;
                text-align: right;
                margin-bottom: 1em;
                text-decoration: none;
                color: #8b4513;
              "
            >
              ¿Olvidaste tu contraseña?
            </a>

            <button class="btn-primary" type="submit">Ingresar</button>
          </form>

          <div class="register-link">
            <small
              >¿No tienes una cuenta?
              <a href="#" id="link-open-register">Regístrate Aquí</a></small
            >
          </div>
        </div>
      </div>

      <!-- ========================================= -->
      <!-- MODAL DE REGISTRO (INCLUIDO EN HOME) -->
      <!-- ========================================= -->
      <div id="register-modal" class="modal-overlay hidden">
        <div class="modal-card">
          <button class="close-modal-btn" data-target="register-modal">
            &times;
          </button>
          <h3 class="card-title">Crear Cuenta</h3>
          <form id="register-form-home">
            <div class="form-floating">
              <input
                type="email"
                class="form-control"
                id="emailRegisterHome"
                placeholder="name@example.com"
                required
              />
            </div>
            <div class="form-floating">
              <input
                type="password"
                class="form-control"
                id="passRegisterHome"
                placeholder="Contraseña"
                required
                minlength="8"
              />
            </div>
            <button class="btn-primary" type="submit">Registrarse</button>
          </form>
        </div>
      </div>

      <!-- ========================================= -->
      <!-- MODAL DE RECUPERACIÓN -->
      <!-- ========================================= -->
      <div id="recovery-modal" class="modal-overlay hidden">
        <div class="modal-card">
          <button class="close-modal-btn" data-target="recovery-modal">
            &times;
          </button>

          <!-- VISTA 1: BUSCAR CUENTA -->
          <div id="rec-step-1" class="fade-in">
            <h3 class="card-title">Recuperar Acceso</h3>
            <p style="margin-bottom: 1.5em; color: #666">
              Ingresa tu correo para buscar tu cuenta.
            </p>
            <form id="rec-form-step-1">
              <input
                type="email"
                class="form-control"
                id="rec-email"
                placeholder="tu@correo.com"
                required
                style="margin-bottom: 1em"
              />
              <button class="btn-primary" type="submit">Buscar Cuenta</button>
            </form>
            <button
              class="btn-back-login"
              style="
                background: none;
                border: none;
                color: #8b4513;
                text-decoration: underline;
                cursor: pointer;
              "
            >
              Volver a Iniciar Sesión
            </button>
          </div>

          <!-- VISTA 2: TOKEN DEL CORREO -->
          <div id="rec-step-2" class="hidden">
            <h3 class="card-title">Restablecer</h3>
            <p style="font-size: 0.9em; margin-bottom: 1.5em; color: #666">
              Hemos enviado un token a <b id="rec-display-email"></b>.<br />
              Cópialo del correo y pégalo aquí.
            </p>
            <form id="rec-form-step-2">
              <input
                type="text"
                class="form-control"
                id="rec-input-code"
                placeholder="Token del correo (copiar y pegar)"
                required
                style="margin-bottom: 1em"
              />
              <input
                type="password"
                class="form-control"
                id="rec-new-pass"
                placeholder="Nueva Contraseña"
                required
                minlength="6"
                style="margin-bottom: 1em"
              />
              <input
                type="password"
                class="form-control"
                id="rec-confirm-pass"
                placeholder="Confirmar Contraseña"
                required
                style="margin-bottom: 1em"
              />
              <button class="btn-primary" type="submit">
                Cambiar Contraseña
              </button>
            </form>
            <button
              class="btn-cancel-rec"
              style="
                background: none;
                border: none;
                color: #888;
                cursor: pointer;
                text-decoration: underline;
              "
            >
              Cancelar
            </button>
          </div>

          <!-- VISTA 3: ÉXITO -->
          <div id="rec-step-3" class="hidden">
            <div style="color: #4caf50; font-size: 4em; margin-bottom: 0.2em">
              ✓
            </div>
            <h3 class="card-title">¡Listo!</h3>
            <p>Tu contraseña ha sido actualizada correctamente.</p>
            <button class="btn-primary btn-back-login" style="margin-top: 1em">
              Iniciar Sesión Ahora
            </button>
          </div>
        </div>
      </div>

      <!-- SECCIONES DE CONTENIDO -->
      <section id="about" class="section">
        <h2 class="section-title">Nuestra Historia</h2>
        <p class="section-subtitle">
          Más que un restaurante, somos una familia apasionada por compartir la
          cultura india.
        </p>
        <div class="about-content">
          <img
            src="images/Home/conocenos.jpg"
            alt="Interior del restaurante Malasa"
          />
          <div>
            <p>
              En Malasa, cada plato cuenta una historia. Fundado en el corazón
              de la ciudad, nuestro restaurante nació del sueño de traer los
              sabores más auténticos de la India a tu mesa. Utilizamos recetas
              familiares transmitidas de generación en generación.
            </p>
          </div>
        </div>
      </section>

      <section id="menu" class="section">
        <h2 class="section-title">La Carta</h2>
        <p class="section-subtitle">
          Explora una variedad de platos que van desde los curries más intensos
          hasta los postres más delicados.
        </p>
        <a href="B04_B05-Catalogo.html" class="cta-button"
          >Ir al Menú Completo</a
        >
      </section>

      <section id="location" class="section">
        <h2 class="section-title">Encuéntranos</h2>
        <p class="section-subtitle">
          Visítanos y vive la experiencia Malasa en persona.
        </p>
        <div class="location-content">
          <div>
            <h4>Nuestra Dirección</h4>
            <p>Avenida Providencia 1233<br />Providencia, Santiago, Chile</p>
            <h4>Horarios</h4>
            <p>Lunes a Sábado: 12:00 - 23:00<br />Domingo: 12:00 - 18:00</p>
          </div>
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d208.11126891192535!2d-70.61812593198744!3d-33.42897168680443!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x9662cf6324c99b71%3A0x5aecd80ceb5fb260!2sAv.%20Nueva%20Providencia%201411!5e0!3m2!1ses!2scl!4v1765150309369!5m2!1ses!2scl"
            width="600"
            height="250"
            style="border: 0"
            allowfullscreen=""
            loading="lazy"
            class="google-map"
          ></iframe>
        </div>
      </section>

      <section id="contact" class="section">
        <h2 class="section-title">Contáctanos</h2>
        <p class="section-subtitle">
          ¿Tienes alguna pregunta, quieres hacer una reserva o alguna critica a
          algun plato? Estamos aquí para ayudarte.
        </p>
        <a href="B06-Formulario_de_Contacto.html" class="cta-button"
          >Enviar un Mensaje</a
        >
      </section>
    </main>

    <footer class="footer">
      <p>© 2024 Restaurante Malasa. Todos los derechos reservados.</p>
    </footer>

    <!-- IMPORTAR SCRIPTS (Orden Importante: API -> Menu Logic -> Script Local) -->
    <script src="api.js"></script>
    <script src="menu_logic.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // === REFERENCIAS DOM ===
        const loginModal = document.getElementById("login-modal");
        const recoveryModal = document.getElementById("recovery-modal");

        const loginBtn = document.getElementById("nav-btn-login");
        const forgotPassBtn = document.getElementById("link-forgot-password");
        const backToLoginBtns = document.querySelectorAll(".btn-back-login");
        const cancelRecBtn = document.querySelector(".btn-cancel-rec");
        const closeButtons = document.querySelectorAll(".close-modal-btn");

        // === FUNCIONES MODALES ===
        const openModal = (modal) => modal.classList.remove("hidden");
        const closeModal = (modal) => modal.classList.add("hidden");
        const closeAllModals = () => {
          loginModal.classList.add("hidden");
          recoveryModal.classList.add("hidden");
        };

        // --- Event Listeners UI ---
        if (loginBtn) {
          loginBtn.addEventListener("click", (e) => {
            e.preventDefault();
            closeAllModals();
            openModal(loginModal);
          });
        }

        closeButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const targetId = btn.getAttribute("data-target");
            document.getElementById(targetId).classList.add("hidden");
          });
        });

        [loginModal, recoveryModal].forEach((modal) => {
          modal.addEventListener("click", (e) => {
            if (e.target === modal) closeModal(modal);
          });
        });

        if (forgotPassBtn) {
          forgotPassBtn.addEventListener("click", (e) => {
            e.preventDefault();
            closeModal(loginModal);
            openModal(recoveryModal);
          });
        }

        backToLoginBtns.forEach((btn) => {
          btn.addEventListener("click", (e) => {
            e.preventDefault();
            closeModal(recoveryModal);
            openModal(loginModal);
          });
        });

        if (cancelRecBtn) {
          cancelRecBtn.addEventListener("click", (e) => {
            e.preventDefault();
            // Resetear pasos a paso 1
            document.getElementById("rec-step-1").classList.remove("hidden");
            document.getElementById("rec-step-2").classList.add("hidden");
            document.getElementById("rec-step-3").classList.add("hidden");
            // Limpiar formularios
            document.getElementById("rec-form-step-1").reset();
            document.getElementById("rec-form-step-2").reset();
          });
        }

        // === LÓGICA DE LOGIN (Usando API) ===
        const loginForm = document.getElementById("login-form");
        if (loginForm) {
          loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("emailLogin").value;
            const pass = document.getElementById("passLogin").value;
            const btn = loginForm.querySelector("button[type='submit']");

            try {
              btn.innerText = "Verificando...";
              btn.disabled = true;

              if (typeof API !== "undefined") {
                // 1. Llamar a API.login
                const user = await API.login(email, pass);

                // 2. Guardar en localStorage
                localStorage.setItem("userRole", user.role);
                localStorage.setItem("userName", user.name);

                alert(`¡Bienvenido ${user.name || user.email}!`);

                // 3. Actualizar menú globalmente usando la función de menu_logic.js
                if (window.updateNavbar) window.updateNavbar();

                // 4. Cerrar modal
                closeAllModals();
                // Recargar opcional para asegurar limpieza
                // window.location.reload();
              } else {
                alert("Error crítico: API no cargada. Revisa api.js");
              }
            } catch (error) {
              alert(error.message);
            } finally {
              btn.innerText = "Ingresar";
              btn.disabled = false;
            }
          });
        }

        // === LÓGICA DE REGISTRO (IN-PLACE EN HOME) ===
        const registerModal = document.getElementById("register-modal");
        const openRegisterLink = document.getElementById("link-open-register");
        const registerFormHome = document.getElementById("register-form-home");

        if (openRegisterLink) {
          openRegisterLink.addEventListener("click", (e) => {
            e.preventDefault();
            closeAllModals();
            openModal(registerModal);
          });
        }

        if (registerFormHome) {
          registerFormHome.addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("nameRegisterHome")
              ? document.getElementById("nameRegisterHome").value.trim()
              : "";
            const email = document
              .getElementById("emailRegisterHome")
              .value.trim();
            const pass = document.getElementById("passRegisterHome").value;
            const btn = registerFormHome.querySelector("button[type='submit']");

            console.log("Register form submit", { name, email });

            try {
              btn.innerText = "Registrando...";
              btn.disabled = true;

              if (typeof API !== "undefined") {
                let res;
                try {
                  res = await API.register(name, email, pass);
                  console.log("API.register response:", res);
                } catch (apiErr) {
                  console.error("API.register error:", apiErr);
                  throw apiErr;
                }

                const user = res && (res.user || res);

                if (user) {
                  try {
                    const u = user.user || user;
                    if (res && res.token)
                      localStorage.setItem("authToken", res.token);
                    localStorage.setItem("userRole", u.role || "customer");
                    localStorage.setItem("userName", u.name || u.email);
                  } catch (e) {
                    console.warn("Error saving user data locally", e);
                  }

                  alert(
                    `¡Registro exitoso! Bienvenido ${
                      user.name || user.email || (res.user && res.user.email)
                    }`
                  );
                  if (window.updateNavbar) window.updateNavbar();
                  closeAllModals();
                } else {
                  alert((res && res.message) || "Registro completado.");
                  closeAllModals();
                }
              } else {
                alert("Error crítico: API no cargada. Revisa api.js");
              }
            } catch (error) {
              console.error("Register handler error:", error);
              alert(error.message || "Error en registro");
            } finally {
              btn.innerText = "Registrarse";
              btn.disabled = false;
            }
          });
        }

        // === LÓGICA DE RECUPERACIÓN (BACKEND REAL) ===
        const recForm1 = document.getElementById("rec-form-step-1");
        const recForm2 = document.getElementById("rec-form-step-2");
        let recoveryEmail = "";

        if (recForm1) {
          recForm1.addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("rec-email").value.trim();
            const btn = recForm1.querySelector("button[type='submit']");

            try {
              btn.innerText = "Buscando...";
              btn.disabled = true;

              if (typeof API !== "undefined") {
                // Llamar al backend para generar y enviar token por correo
                const res = await API.requestPasswordReset(email);
                console.log("requestPasswordReset response:", res);

                // Guardar email para paso 2
                recoveryEmail = email;
                document.getElementById("rec-display-email").textContent =
                  email;

                // Mostrar paso 2 con mensaje de token por correo
                document.getElementById("rec-step-1").classList.add("hidden");
                document
                  .getElementById("rec-step-2")
                  .classList.remove("hidden");
                document.getElementById("rec-step-2").classList.add("fade-in");

                alert(
                  "Hemos enviado un token a tu correo. Intenta en 15 minutos."
                );
              } else {
                alert("Error crítico: API no cargada. Revisa api.js");
              }
            } catch (error) {
              console.error("requestPasswordReset error:", error);
              alert(error.message || "Error al buscar cuenta");
            } finally {
              btn.innerText = "Buscar Cuenta";
              btn.disabled = false;
            }
          });
        }

        if (recForm2) {
          recForm2.addEventListener("submit", async (e) => {
            e.preventDefault();
            const token = document
              .getElementById("rec-input-code")
              .value.trim();
            const pass1 = document.getElementById("rec-new-pass").value;
            const pass2 = document.getElementById("rec-confirm-pass").value;
            const btn = recForm2.querySelector("button[type='submit']");

            if (pass1 !== pass2) {
              alert("Las contraseñas no coinciden.");
              return;
            }

            try {
              btn.innerText = "Cambiando...";
              btn.disabled = true;

              if (typeof API !== "undefined") {
                // Llamar al backend para cambiar contraseña
                const res = await API.resetPassword(token, pass1);
                console.log("resetPassword response:", res);

                // Mostrar paso 3 (éxito)
                document.getElementById("rec-step-2").classList.add("hidden");
                document
                  .getElementById("rec-step-3")
                  .classList.remove("hidden");
                document.getElementById("rec-step-3").classList.add("fade-in");
              } else {
                alert("Error crítico: API no cargada. Revisa api.js");
              }
            } catch (error) {
              console.error("resetPassword error:", error);
              alert(
                error.message ||
                  "Error al cambiar contraseña. Token inválido o expirado."
              );
            } finally {
              btn.innerText = "Cambiar Contraseña";
              btn.disabled = false;
            }
          });
        }
      });
    </script>
  </body>
</html>
