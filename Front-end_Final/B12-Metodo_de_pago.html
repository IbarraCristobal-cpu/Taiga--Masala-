<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finalizar Compra - Malasa</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Open+Sans:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --color-primario: #ff9933;
        --color-secundario: #8b4513;
        --color-fondo-pagina: #f8f9fa;
        --color-surface: #ffffff;
        --color-texto: #4a2e2a;
        --color-texto-secundario: #6c757d;
        --color-accion-primaria: #007bff;
        --fuente-titulos: "Lora", serif;
        --fuente-cuerpo: "Open Sans", sans-serif;
      }

      body {
        font-family: var(--fuente-cuerpo);
        background-color: var(--color-fondo-pagina);
        color: var(--color-texto);
        margin: 0;
        padding-bottom: 3em;
      }

      /* Barra de Navegación */
      .navbar {
        background-color: var(--color-surface);
        padding: 0.5rem 1rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .navbar-container {
        width: 100%;
        max-width: 1140px;
        margin: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .navbar-brand {
        font-family: var(--fuente-titulos);
        font-weight: 700;
        font-size: 1.5rem;
        color: var(--color-texto);
        text-decoration: none;
        display: flex;
        align-items: center;
      }
      .navbar-brand img {
        margin-right: 0.5rem;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        object-fit: cover;
      }
      .navbar-nav {
        list-style: none;
        display: flex;
        gap: 1.5rem;
        margin: 0;
      }
      .nav-link {
        color: var(--color-texto);
        text-decoration: none;
        font-weight: 600;
      }
      .nav-link.active,
      .nav-link:hover {
        color: var(--color-primario);
      }

      /* Contenedor Principal de Pago */
      .checkout-container {
        max-width: 600px;
        margin: 3rem auto;
        padding: 2rem;
        background-color: var(--color-surface);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      }
      .page-title {
        font-family: var(--fuente-titulos);
        color: var(--color-secundario);
        font-size: 1.8em;
        margin-top: 0;
        margin-bottom: 1.5em;
        text-align: center;
      }

      .form-section {
        margin-bottom: 1.5em;
        padding-bottom: 1.5em;
        border-bottom: 1px solid #eee;
      }
      .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }
      .form-section h3 {
        font-size: 1.2em;
        margin: 0 0 1em 0;
        color: var(--color-texto);
      }
      .form-section label {
        font-weight: 600;
        display: block;
        margin-bottom: 0.5em;
        font-size: 0.9em;
      }
      .form-section select,
      .form-section input[type="text"],
      .form-section input[type="number"],
      .form-section textarea {
        width: 100%;
        padding: 0.8em;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1em;
        box-sizing: border-box;
        background-color: #fff;
      }
      .form-row {
        display: flex;
        gap: 1em;
      }
      .form-row .form-field {
        flex: 1;
      }
      .checkbox-group {
        display: flex;
        align-items: center;
        margin-top: 1em;
      }
      .checkbox-group input[type="checkbox"] {
        margin-right: 0.5em;
        width: auto;
      }
      .checkbox-group label {
        margin-bottom: 0;
        font-weight: normal;
        font-size: 0.9em;
      }

      .delivery-options label {
        display: inline-block;
        margin-right: 1.5em;
        font-weight: normal;
      }
      .delivery-options input[type="radio"] {
        margin-right: 0.5em;
      }

      .address-section {
        margin-top: 1em;
      }
      .address-new-fields {
        display: flex;
        flex-direction: column;
        gap: 0.8em;
        margin-top: 1em;
      }

      .submit-button {
        width: 100%;
        padding: 1em;
        margin-top: 2em;
        border: none;
        border-radius: 8px;
        font-size: 1.1em;
        font-weight: 700;
        cursor: pointer;
        background-color: var(--color-accion-primaria);
        color: white;
        transition: transform 0.2s;
      }
      .submit-button:hover {
        transform: scale(1.02);
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="navbar-container">
        <a class="navbar-brand" href="#">
          <img src="images/Logo/flor.jpg" alt="Logo Masala" />
          Masala
        </a>
        <ul class="navbar-nav">
          <li><a class="nav-link" href="B07-Home.html">Home</a></li>
          <li><a class="nav-link" href="B04_B05-Catalogo.html">Catálogo</a></li>
          <li>
            <a class="nav-link" href="B06-Formulario_de_Contacto.html"
              >Contacto</a
            >
          </li>
          <li>
            <a class="nav-link" href="B08_B09-Perfil_de_usuario.html"
              >Mi Perfil</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <main class="checkout-container">
      <h2 class="page-title">Finalizar compra</h2>
      <form id="checkout-form">
        <div class="form-section">
          <h3>Tipo de Entrega</h3>
          <div class="delivery-options">
            <label>
              <input type="radio" name="deliveryType" value="pickup" checked />
              Servir en Mesa
            </label>
            <label>
              <input type="radio" name="deliveryType" value="delivery" />
              Delivery
            </label>
          </div>
        </div>

        <div id="address-section" class="form-section hidden">
          <h3>Dirección de Envío</h3>
          <div class="address-options">
            <label for="saved-address-select">Usar dirección guardada</label>
            <select id="saved-address-select">
              <option value="">-- Seleccione una dirección --</option>
            </select>
            <p
              style="
                margin: 1em 0 0.5em 0;
                text-align: center;
                color: var(--color-texto-secundario);
              "
            >
              O
            </p>
            <label>Agregar nueva dirección</label>
            <div class="address-new-fields">
              <input
                type="text"
                id="new-address-street"
                placeholder="Calle y Número"
              />
              <input
                type="text"
                id="new-address-details"
                placeholder="Depto / Casa / Oficina (Opcional)"
              />
              <input type="text" id="new-address-city" placeholder="Comuna" />
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3>Método de Pago</h3>
          <div class="form-group">
            <label for="saved-cards-select">Usar tarjeta guardada</label>
            <select id="saved-cards-select">
              <option value="">-- Seleccione una tarjeta --</option>
            </select>
          </div>
          <p
            style="
              margin: 1em 0 0.5em 0;
              text-align: center;
              color: var(--color-texto-secundario);
            "
          >
            O
          </p>
          <label>Agregar nueva tarjeta</label>
          <input
            type="text"
            id="card-number"
            placeholder="Número de Tarjeta (XXXX XXXX XXXX XXXX)"
            maxlength="19"
            autocomplete="cc-number"
          />
          <div class="form-row" style="margin-top: 1em">
            <div class="form-field">
              <input
                type="text"
                id="card-expiry"
                placeholder="MM/AA"
                maxlength="5"
                autocomplete="cc-exp"
              />
            </div>
            <div class="form-field">
              <input
                type="text"
                id="card-cvv"
                placeholder="CVV"
                maxlength="4"
                autocomplete="cc-csc"
              />
            </div>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="save-card-checkbox" />
            <label for="save-card-checkbox"
              >Guardar esta tarjeta para futuras compras</label
            >
          </div>
        </div>

        <button type="submit" class="submit-button">Finalizar Compra</button>
      </form>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let savedCards = [
          { id: 1, type: "Visa", last4: "4246", expiry: "12/2028" },
          { id: 2, type: "Visa", last4: "7425", expiry: "08/2026" },
        ];
        let savedAddresses = [
          { id: 101, street: "Av. Providencia 1322", city: "Providencia" },
          { id: 102, street: "Calle Falsa 123", city: "Providencia" },
        ];

        const checkoutForm = document.getElementById("checkout-form");
        const deliveryTypeRadios = document.querySelectorAll(
          'input[name="deliveryType"]'
        );
        const addressSection = document.getElementById("address-section");
        const savedCardsSelect = document.getElementById("saved-cards-select");
        const saveCardCheckbox = document.getElementById("save-card-checkbox");
        const cardNumberInput = document.getElementById("card-number");
        const savedAddressSelect = document.getElementById(
          "saved-address-select"
        );

        const renderSavedCardsDropdown = () => {
          savedCardsSelect.innerHTML =
            '<option value="">-- Seleccione una tarjeta --</option>';
          savedCards.forEach((card) => {
            const option = document.createElement("option");
            option.value = card.id;
            option.textContent = `${card.type} terminada en ${card.last4}`;
            savedCardsSelect.appendChild(option);
          });
        };

        const renderSavedAddressesDropdown = () => {
          savedAddressSelect.innerHTML =
            '<option value="">-- Seleccione una dirección --</option>';
          savedAddresses.forEach((address) => {
            const option = document.createElement("option");
            option.value = address.id;
            option.textContent = `${address.street}, ${address.city}`;
            savedAddressSelect.appendChild(option);
          });
        };

        // Función para actualizar selects
        const updateDropdowns = () => {
          renderSavedCardsDropdown();
          renderSavedAddressesDropdown();
        };

        deliveryTypeRadios.forEach((radio) => {
          radio.addEventListener("change", (event) => {
            if (event.target.value === "delivery") {
              addressSection.classList.remove("hidden");
            } else {
              addressSection.classList.add("hidden");
            }
          });
        });

        // Simular finalizar Compra
        checkoutForm.addEventListener("submit", (event) => {
          event.preventDefault();

          const deliveryType = document.querySelector(
            'input[name="deliveryType"]:checked'
          ).value;
          if (deliveryType === "delivery") {
            const selectedAddress = savedAddressSelect.value;
            const newStreet =
              document.getElementById("new-address-street").value;
            if (!selectedAddress && !newStreet) {
              alert("Por favor, seleccione o ingrese una dirección de envío.");
              return;
            }
          }

          const selectedCard = savedCardsSelect.value;
          const newCardNumber = cardNumberInput.value;
          if (!selectedCard && !newCardNumber) {
            alert("Por favor, seleccione o ingrese un método de pago.");
            return;
          }

          if (
            saveCardCheckbox.checked &&
            newCardNumber.replace(/\s/g, "").length >= 16
          ) {
            const newCard = {
              id: Date.now(),
              type: "Visa",
              last4: newCardNumber.replace(/\s/g, "").slice(-4),
              expiry: document.getElementById("card-expiry").value || "N/A",
            };
            savedCards.push(newCard);
            updateDropdowns();
            alert(
              `¡Compra exitosa! Tarjeta terminada en ${newCard.last4} guardada.`
            );
            cardNumberInput.value = "";
            document.getElementById("card-expiry").value = "";
            document.getElementById("card-cvv").value = "";
            saveCardCheckbox.checked = false;
          } else {
            alert("¡Compra exitosa!");
          }
        });

        cardNumberInput.addEventListener("input", (e) => {
          const value = e.target.value.replace(/\D/g, "");
          const groups = value.match(/.{1,4}/g);
          e.target.value = groups ? groups.join(" ").slice(0, 19) : "";
        });

        // Auto-formatear fecha de expiración MM/AA
        document
          .getElementById("card-expiry")
          .addEventListener("input", (e) => {
            let value = e.target.value.replace(/\D/g, ""); // Solo dígitos
            if (value.length > 2) {
              value = value.slice(0, 2) + "/" + value.slice(2);
            }
            e.target.value = value.slice(0, 5);
          });

        updateDropdowns();
      });
    </script>
  </body>
</html>
